<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Uma Musume Hidden Factor Filter</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #ff6b6b, #ffa500);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .main-content {
            padding: 30px;
        }

        .filter-section {
            margin-bottom: 30px;
        }

        .filter-level {
            margin-bottom: 20px;
        }

        .filter-level h3 {
            margin-bottom: 15px;
            color: #333;
            font-size: 1.3em;
            border-bottom: 2px solid #eee;
            padding-bottom: 5px;
        }

        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }

        .filter-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.95em;
            font-weight: 500;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .filter-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
        }

        .filter-btn.active {
            background: linear-gradient(135deg, #ff6b6b, #ffa500);
            transform: scale(1.05);
        }

        .clear-btn {
            background: linear-gradient(135deg, #6c757d, #495057);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            margin-left: 10px;
        }

        .clear-btn:hover {
            background: linear-gradient(135deg, #495057, #343a40);
        }

        .breadcrumb {
            background: #f8f9fa;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 0.95em;
            color: #6c757d;
        }

        .results-section {
            margin-top: 30px;
        }

        .results-section h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.4em;
        }

        .factor-card {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .factor-card:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .factor-name {
            font-size: 1.2em;
            font-weight: bold;
            color: #495057;
            margin-bottom: 8px;
        }

        .factor-condition {
            color: #6c757d;
            line-height: 1.5;
        }

        .no-results {
            text-align: center;
            padding: 40px;
            color: #6c757d;
            font-size: 1.1em;
        }

        .stats {
            background: #e9ecef;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            color: #495057;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }
            
            .button-group {
                justify-content: center;
            }
            
            .filter-btn {
                font-size: 0.9em;
                padding: 10px 16px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ‡ Uma Musume Hidden Factor Filter</h1>
            <p>Find hidden factors by clicking through conditions step by step</p>
        </div>

        <div class="main-content">
            <div class="filter-section">
                <div class="breadcrumb" id="breadcrumb">
                    Click a main category to start filtering
                </div>

                <div class="stats" id="stats">
                    Showing all 46 hidden factors
                </div>

                <div class="filter-level" id="mainCategories">
                    <h3>ğŸ¯ Main Categories</h3>
                    <div class="button-group">
                        <button class="filter-btn" onclick="selectMainCategory('racing')">ğŸ‡ Racing</button>
                        <button class="filter-btn" onclick="selectMainCategory('skills')">ğŸŒŸ Skills</button>
                        <button class="filter-btn" onclick="selectMainCategory('training')">ğŸ’ª Training</button>
                        <button class="filter-btn" onclick="selectMainCategory('aptitudes')">ğŸ“Š Aptitudes & Stats</button>
                        <button class="filter-btn" onclick="selectMainCategory('events')">ğŸ¯ Events & Misc</button>
                        <button class="clear-btn" onclick="clearFilters()">Clear All</button>
                    </div>
                </div>

                <div class="filter-level" id="subCategories" style="display: none;">
                    <h3 id="subCategoryTitle">Subcategories</h3>
                    <div class="button-group" id="subCategoryButtons"></div>
                </div>

                <div class="filter-level" id="detailFilters" style="display: none;">
                    <h3 id="detailFilterTitle">Detailed Filters</h3>
                    <div class="button-group" id="detailFilterButtons"></div>
                </div>
            </div>

            <div class="results-section">
                <h3>ğŸ“‹ Matching Hidden Factors</h3>
                <div id="results"></div>
            </div>
        </div>
    </div>

    <script>
        // Parse CSV data
        const csvData = `Factor Name (JP/EN),Conditions
é€£æˆ¦é€£å‹ (Ren Sen Renshou),"Win a high number of consecutive races, such as 12 or more, primarily in G1 races."
æ±ã®é›„ (Higashi no Ou),"Win 7 or more G1 races in Eastern Japan (Tokyo, Nakayama)."
è¥¿ã®é›„ (Nishi no Ou),"Win 7 or more G1 races in Western Japan (Kyoto, Hanshin)."
æ—…äºº (Tabibito),Participate in races at 7 or more different racecourses.
å…¨éšç´šåˆ¶è¦‡ (Zen Kaikyuu Seiha),"Win at least one race in each distance category: Short, Mile, Medium, and Long."
å©ãè‰¯åŒ–å‹ (Tataki Ryouka-gata),Run 3 consecutive races; may also be tied to the reporter's 'æ‚¦æ¥½å–æ' (Pleasure Interview) event.
ç”²æ–æ€§ãªã— (Kaishou nashi),Finish a run with at least one purple skill.
å¥é—˜ (Kentou),"Win or lose by a small margin, or possibly by using a Clock to continue a run."
è«¦ã‚ãªã„å¿ƒ (Akiramenai Kokoro),"Use a Clock to continue after a loss, or lose by a small margin multiple times."
åéª¨ç²¾ç¥ (Hankotsu Seishin),Win a race with a C or lower aptitude for either ground or distance.
ãƒ‘ãƒ¼ãƒ•ã‚§ã‚¯ãƒˆã‚¯ãƒ©ã‚¦ãƒ³ (Perfect Crown),"Win the Japanese Triple Crown (çšæœˆè³, æ—¥æœ¬ãƒ€ãƒ¼ãƒ“ãƒ¼, èŠèŠ±è³) plus specific trial races (å¼¥ç”Ÿè³, é’è‘‰è³, and ç¥æˆ¸æ–°èæ¯)."
ãƒ‘ãƒ¼ãƒ•ã‚§ã‚¯ãƒˆãƒ†ã‚£ã‚¢ãƒ© (Perfect Tiara),"Win the Japanese Fillies' Triple Crown (æ¡œèŠ±è³, ã‚ªãƒ¼ã‚¯ã‚¹, ç§‹è¯è³) plus specific trial races (ãƒãƒ¥ãƒ¼ãƒªãƒƒãƒ—S, ãƒ•ãƒ­ãƒ¼ãƒ©S, and ãƒ­ãƒ¼ã‚ºS)."
ä¸€å¹´ã®è¨ˆã¯ (Ichinen no Kei wa),Win either the ä¸­å±±é‡‘æ¯ or äº¬éƒ½é‡‘æ¯ in the senior year.
SSS,Win 3 races from the Summer Sprint Series.
SMS,Win 3 races from the Summer Mile Series.
S2000,Win 3 races from the Summer 2000 Series.
æ˜Ÿã«é¡˜ã„ã‚’ (Hoshi ni Negai wo),Win 3 races from the 'star/constellation' series.
ã‚¸ãƒ¥ã‚¨ãƒªãƒ¼ (Jewelry),Win 3 races from the 'jewel' series.
æ–°èå±‹ã•ã‚“ (Shimbun-ya-san),"Win all four races with 'æ–°èæ¯' in their name: äº¬éƒ½æ–°èæ¯, ç¥æˆ¸æ–°èæ¯, ä¸­æ—¥æ–°èæ¯, and æ±äº¬æ–°èæ¯."
å³/å·¦ã®ç›®è¦šã‚ (Migi/Hidari no Mezame),Win at least 6 races with a specified turn direction.
æ˜¥/å¤/ç§‹/å†¬ã®ç›®è¦šã‚ (Haru/Natsu/Aki/Fuyu no Mezame),Win at least 6 races in the specified season.
ãŠå¬¢æ§˜ (Ojou-sama),Obtain the skills 'ã—ã¨ã‚„ã‹ãªè¶³å–ã‚Š' and 'å“è¡Œæ–¹æ­£' simultaneously.
å¤ªé™½ç³» (Taiyou-kei),Obtain exactly 8 skills with 'â—¯' in their names.
ãƒãƒ¼ãƒ–ãƒ¬ãƒ¼ã‚­ (No Brake),Obtain at least 3 skills related to downhill running.
å±±å¨˜ (Yama-musume),"Obtain at least 3 skills related to uphill running: 'ç™»å±±å®¶', 'å‹¢ã„ä»»ã›', 'åä¸‡ãƒãƒªã‚­', or 'ç™»ç«œé–€'."
ãƒ”ã‚«ãƒ”ã‚« (Pikapika),Obtain at least 2 skills with 'å…‰' (light) or 'é›»' (electricity) in their names.
ãƒ“ãƒ¥ãƒ¼ãƒ“ãƒ¥ãƒ¼ (Byuubyuu),Obtain at least 2 skills with 'é¢¨' (wind) in their names.
å…¨å¤©å€™å‹ (Zentenkou-gata),"Obtain the skills 'æ™´ã‚Œã®æ—¥â—¯', 'æ›‡ã‚Šã®æ—¥â—¯', 'é›¨ã®æ—¥â—¯', and 'é›ªã®æ—¥â—¯' simultaneously."
å‡ºãŸã¨ã“å‹è²  (Detatoko Shoubu),Obtain the skills 'å‘ã“ã†è¦‹ãš' and 'å¾Œå…ˆæã‚Œãš' simultaneously.
ä¼ç”»ä¸Šæ‰‹ (Kikaku Jouzu),Obtain at least 3 skills with 'ãƒ—ãƒ©ãƒ³' (plan) in their names.
ç­–ç•¥å®¶ (Sakuryaku-ka),Obtain at least 2 skills with 'ç­–' (strategy) in their names.
ã‚¦ãƒå¨˜ã‚ˆå¤§å¿—ã‚’æŠ±ã‘ (Uma Musume yo Taishi wo Idake),Obtain at least 3 skills with 'å¿—' (ambition) in their names.
å¤§è‚ºæ´»é‡ (Dai Haikatsuryou),Obtain at least 3 skills with 'å‘¼å¸' (breathing) or 'æ¯' (breath) in their names.
æ±å¥”è¥¿èµ° (Touhon Seisou),Obtain at least 3 racecourse passive skills at level â—.
æƒ³ã„ã®ç¶™ãæ‰‹ (Omoi no Tsugite),Obtain at least 3 inherited unique skills.
ä¿¡é ¼ã®è¨¼ (Shinrai no Akashi),Take at least 6 regular outings with the Uma Musume.
ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ (Refresh),Trigger the hot spring event by winning the 'æ¸©æ³‰æ—…è¡Œåˆ¸' lottery ticket.
äºŒåˆ€æµ (Nitou-ryuu),"Have all ground aptitudes (Turf/Dirt) at A, and win on both surfaces."
SMILE,Have all distance aptitudes at A or higher.
è‡ªç”±è‡ªåœ¨ (Jiyuu Jizai),Have all racing style aptitudes at A or higher.
ã‚¸ãƒ£ãƒƒã‚¯ãƒãƒƒãƒˆ (Jackpot),Have at least 3 status stats reach exactly 777.
ã‚¹ãƒ”ãƒ¼ãƒ‰ã®ç›®è¦šã‚ (Speed no Mezame),Successfully complete Speed training at least 12 times.
ã‚¹ã‚¿ãƒŸãƒŠã®ç›®è¦šã‚ (Stamina no Mezame),Successfully complete Stamina training at least 12 times.
ãƒ‘ãƒ¯ãƒ¼ã®ç›®è¦šã‚ (Power no Mezame),Successfully complete Power training at least 12 times.
æ ¹æ€§ã®ç›®è¦šã‚ (Guts no Mezame),Successfully complete Guts training at least 12 times.
è³¢ã•ã®ç›®è¦šã‚ (Intelligence no Mezame),Successfully complete Intelligence training at least 12 times.`;

        // Parse the CSV data into an array of objects
        function parseCSV(csvText) {
            const lines = csvText.trim().split('\n');
            const headers = lines[0].split(',');
            const factors = [];

            for (let i = 1; i < lines.length; i++) {
                const line = lines[i];
                if (line.trim()) {
                    const match = line.match(/^([^,]+),(.*)$/);
                    if (match) {
                        factors.push({
                            name: match[1].trim(),
                            condition: match[2].trim().replace(/^"(.*)"$/, '$1')
                        });
                    }
                }
            }
            return factors;
        }

        const allFactors = parseCSV(csvData);
        let currentFilters = {
            mainCategory: null,
            subCategory: null,
            detailFilter: null
        };

        // Category definitions with intelligent classification
        const categoryData = {
            racing: {
                name: 'ğŸ‡ Racing',
                subcategories: {
                    winRaces: {
                        name: 'Win Races',
                        keywords: ['win', 'victory'],
                        detailFilters: {
                            consecutive: { name: 'Consecutive Wins', keywords: ['consecutive', 'é€£æˆ¦', 'é€£å‹'] },
                            location: { name: 'Location-based', keywords: ['eastern', 'western', 'æ±', 'è¥¿', 'tokyo', 'kyoto', 'nakayama', 'hanshin'] },
                            series: { name: 'Race Series', keywords: ['triple crown', 'series', 'summer', 'sss', 'sms', 's2000', 'crown', 'tiara', 'æ–°è'] },
                            distance: { name: 'Distance Categories', keywords: ['distance category', 'short', 'mile', 'medium', 'long', 'éšç´š'] },
                            timing: { name: 'Time-based', keywords: ['season', 'turn direction', 'æ˜¥', 'å¤', 'ç§‹', 'å†¬', 'å³', 'å·¦', 'ç›®è¦šã‚'] },
                            special: { name: 'Special Conditions', keywords: ['aptitude', 'margin', 'clock', 'senior year', 'é‡‘æ¯'] }
                        }
                    },
                    participation: {
                        name: 'Race Participation',
                        keywords: ['participate', 'racecourse', 'run'],
                        detailFilters: {
                            multiple: { name: 'Multiple Racecourses', keywords: ['different racecourse', 'racecourse'] },
                            consecutive: { name: 'Consecutive Races', keywords: ['consecutive races', 'run 3'] }
                        }
                    },
                    performance: {
                        name: 'Race Performance',
                        keywords: ['margin', 'clock', 'lose'],
                        detailFilters: {
                            margins: { name: 'Small Margins', keywords: ['small margin'] },
                            continue: { name: 'Continue After Loss', keywords: ['clock', 'continue'] }
                        }
                    }
                }
            },
            skills: {
                name: 'ğŸŒŸ Skills',
                subcategories: {
                    themed: {
                        name: 'Themed Skills',
                        keywords: ['skills with', 'skills related'],
                        detailFilters: {
                            symbols: { name: 'Symbol Skills', keywords: ['â—¯', 'circle'] },
                            elements: { name: 'Element Skills', keywords: ['å…‰', 'é›»', 'é¢¨', 'light', 'electricity', 'wind'] },
                            terrain: { name: 'Terrain Skills', keywords: ['downhill', 'uphill', 'ç™»å±±', 'å‹¢ã„'] },
                            weather: { name: 'Weather Skills', keywords: ['æ™´ã‚Œ', 'æ›‡ã‚Š', 'é›¨', 'é›ª', 'weather'] },
                            strategy: { name: 'Strategy Skills', keywords: ['ãƒ—ãƒ©ãƒ³', 'ç­–', 'å¿—', 'plan', 'strategy', 'ambition'] },
                            physical: { name: 'Physical Skills', keywords: ['å‘¼å¸', 'æ¯', 'breathing', 'breath'] }
                        }
                    },
                    combinations: {
                        name: 'Skill Combinations',
                        keywords: ['simultaneously', 'combination'],
                        detailFilters: {
                            specific: { name: 'Specific Combinations', keywords: ['ã—ã¨ã‚„ã‹', 'å“è¡Œæ–¹æ­£', 'å‘ã“ã†è¦‹ãš', 'å¾Œå…ˆ'] }
                        }
                    },
                    special: {
                        name: 'Special Skills',
                        keywords: ['purple', 'inherited', 'unique', 'racecourse passive'],
                        detailFilters: {
                            purple: { name: 'Purple Skills', keywords: ['purple skill'] },
                            inherited: { name: 'Inherited Skills', keywords: ['inherited unique'] },
                            passive: { name: 'Passive Skills', keywords: ['racecourse passive'] }
                        }
                    }
                }
            },
            training: {
                name: 'ğŸ’ª Training',
                subcategories: {
                    stats: {
                        name: 'Stat Training',
                        keywords: ['complete', 'training'],
                        detailFilters: {
                            speed: { name: 'Speed Training', keywords: ['speed training'] },
                            stamina: { name: 'Stamina Training', keywords: ['stamina training'] },
                            power: { name: 'Power Training', keywords: ['power training'] },
                            guts: { name: 'Guts Training', keywords: ['guts training'] },
                            intelligence: { name: 'Intelligence Training', keywords: ['intelligence training'] }
                        }
                    }
                }
            },
            aptitudes: {
                name: 'ğŸ“Š Aptitudes & Stats',
                subcategories: {
                    aptitudes: {
                        name: 'Aptitudes',
                        keywords: ['aptitude', 'aptitudes'],
                        detailFilters: {
                            ground: { name: 'Ground Aptitudes', keywords: ['ground aptitudes', 'turf', 'dirt'] },
                            distance: { name: 'Distance Aptitudes', keywords: ['distance aptitudes'] },
                            racing: { name: 'Racing Style Aptitudes', keywords: ['racing style aptitudes'] }
                        }
                    },
                    stats: {
                        name: 'Status Stats',
                        keywords: ['status stats', 'reach'],
                        detailFilters: {
                            specific: { name: 'Specific Values', keywords: ['777', 'exactly'] }
                        }
                    }
                }
            },
            events: {
                name: 'ğŸ¯ Events & Misc',
                subcategories: {
                    social: {
                        name: 'Social Events',
                        keywords: ['outings', 'regular outings'],
                        detailFilters: {
                            outings: { name: 'Regular Outings', keywords: ['regular outings'] }
                        }
                    },
                    special: {
                        name: 'Special Events',
                        keywords: ['hot spring', 'lottery', 'event'],
                        detailFilters: {
                            hotspring: { name: 'Hot Spring Event', keywords: ['hot spring', 'æ¸©æ³‰'] }
                        }
                    }
                }
            }
        };

        // Filter factors based on current selection
        function getFilteredFactors() {
            let filtered = [...allFactors];

            if (currentFilters.mainCategory) {
                const category = categoryData[currentFilters.mainCategory];
                filtered = filtered.filter(factor => 
                    matchesKeywords(factor.condition.toLowerCase(), getAllCategoryKeywords(category))
                );

                if (currentFilters.subCategory) {
                    const subCategory = category.subcategories[currentFilters.subCategory];
                    filtered = filtered.filter(factor => 
                        matchesKeywords(factor.condition.toLowerCase(), subCategory.keywords)
                    );

                    if (currentFilters.detailFilter) {
                        const detailFilter = subCategory.detailFilters[currentFilters.detailFilter];
                        filtered = filtered.filter(factor => 
                            matchesKeywords(factor.condition.toLowerCase(), detailFilter.keywords)
                        );
                    }
                }
            }

            return filtered;
        }

        function getAllCategoryKeywords(category) {
            let allKeywords = [];
            Object.values(category.subcategories).forEach(sub => {
                allKeywords = allKeywords.concat(sub.keywords);
                if (sub.detailFilters) {
                    Object.values(sub.detailFilters).forEach(detail => {
                        allKeywords = allKeywords.concat(detail.keywords);
                    });
                }
            });
            return allKeywords;
        }

        function matchesKeywords(text, keywords) {
            return keywords.some(keyword => text.includes(keyword.toLowerCase()));
        }

        // UI Functions
        function selectMainCategory(category) {
            currentFilters.mainCategory = category;
            currentFilters.subCategory = null;
            currentFilters.detailFilter = null;
            
            updateActiveButtons('mainCategories', category);
            showSubCategories(category);
            hideElement('detailFilters');
            updateResults();
            updateBreadcrumb();
        }

        function selectSubCategory(subCategory) {
            currentFilters.subCategory = subCategory;
            currentFilters.detailFilter = null;
            
            updateActiveButtons('subCategoryButtons', subCategory);
            showDetailFilters(currentFilters.mainCategory, subCategory);
            updateResults();
            updateBreadcrumb();
        }

        function selectDetailFilter(detailFilter) {
            currentFilters.detailFilter = detailFilter;
            
            updateActiveButtons('detailFilterButtons', detailFilter);
            updateResults();
            updateBreadcrumb();
        }

        function showSubCategories(mainCategory) {
            const subCategoriesDiv = document.getElementById('subCategories');
            const buttonsDiv = document.getElementById('subCategoryButtons');
            const titleDiv = document.getElementById('subCategoryTitle');
            
            const category = categoryData[mainCategory];
            titleDiv.textContent = `${category.name} - Subcategories`;
            
            buttonsDiv.innerHTML = '';
            Object.entries(category.subcategories).forEach(([key, subCat]) => {
                const button = document.createElement('button');
                button.className = 'filter-btn';
                button.textContent = subCat.name;
                button.onclick = () => selectSubCategory(key);
                buttonsDiv.appendChild(button);
            });
            
            const clearBtn = document.createElement('button');
            clearBtn.className = 'clear-btn';
            clearBtn.textContent = 'Back to Main';
            clearBtn.onclick = () => clearSubFilters();
            buttonsDiv.appendChild(clearBtn);
            
            subCategoriesDiv.style.display = 'block';
        }

        function showDetailFilters(mainCategory, subCategory) {
            const detailFiltersDiv = document.getElementById('detailFilters');
            const buttonsDiv = document.getElementById('detailFilterButtons');
            const titleDiv = document.getElementById('detailFilterTitle');
            
            const category = categoryData[mainCategory];
            const subCat = category.subcategories[subCategory];
            
            if (!subCat.detailFilters) {
                detailFiltersDiv.style.display = 'none';
                return;
            }
            
            titleDiv.textContent = `${subCat.name} - Detailed Filters`;
            
            buttonsDiv.innerHTML = '';
            Object.entries(subCat.detailFilters).forEach(([key, detail]) => {
                const button = document.createElement('button');
                button.className = 'filter-btn';
                button.textContent = detail.name;
                button.onclick = () => selectDetailFilter(key);
                buttonsDiv.appendChild(button);
            });
            
            const clearBtn = document.createElement('button');
            clearBtn.className = 'clear-btn';
            clearBtn.textContent = 'Back to Subcategory';
            clearBtn.onclick = () => clearDetailFilters();
            buttonsDiv.appendChild(clearBtn);
            
            detailFiltersDiv.style.display = 'block';
        }

        function updateActiveButtons(containerId, activeValue) {
            const container = document.getElementById(containerId);
            const buttons = container.querySelectorAll('.filter-btn');
            buttons.forEach(btn => {
                btn.classList.remove('active');
            });
            
            if (activeValue) {
                buttons.forEach(btn => {
                    if (btn.textContent.toLowerCase().includes(activeValue.toLowerCase()) ||
                        btn.onclick.toString().includes(activeValue)) {
                        btn.classList.add('active');
                    }
                });
            }
        }

        function updateResults() {
            const filtered = getFilteredFactors();
            const resultsDiv = document.getElementById('results');
            const statsDiv = document.getElementById('stats');
            
            statsDiv.textContent = `Showing ${filtered.length} of ${allFactors.length} hidden factors`;
            
            if (filtered.length === 0) {
                resultsDiv.innerHTML = '<div class="no-results">No hidden factors match your current filters.</div>';
                return;
            }
            
            resultsDiv.innerHTML = filtered.map(factor => `
                <div class="factor-card">
                    <div class="factor-name">${factor.name}</div>
                    <div class="factor-condition">${factor.condition}</div>
                </div>
            `).join('');
        }

        function updateBreadcrumb() {
            const breadcrumbDiv = document.getElementById('breadcrumb');
            let breadcrumb = [];
            
            if (currentFilters.mainCategory) {
                const category = categoryData[currentFilters.mainCategory];
                breadcrumb.push(category.name);
                
                if (currentFilters.subCategory) {
                    const subCategory = category.subcategories[currentFilters.subCategory];
                    breadcrumb.push(subCategory.name);
                    
                    if (currentFilters.detailFilter) {
                        const detailFilter = subCategory.detailFilters[currentFilters.detailFilter];
                        breadcrumb.push(detailFilter.name);
                    }
                }
            }
            
            if (breadcrumb.length === 0) {
                breadcrumbDiv.textContent = 'Click a main category to start filtering';
            } else {
                breadcrumbDiv.textContent = breadcrumb.join(' â†’ ');
            }
        }

        function hideElement(elementId) {
            document.getElementById(elementId).style.display = 'none';
        }

        function clearFilters() {
            currentFilters = { mainCategory: null, subCategory: null, detailFilter: null };
            hideElement('subCategories');
            hideElement('detailFilters');
            updateActiveButtons('mainCategories', null);
            updateResults();
            updateBreadcrumb();
        }

        function clearSubFilters() {
            currentFilters.subCategory = null;
            currentFilters.detailFilter = null;
            hideElement('detailFilters');
            updateActiveButtons('subCategoryButtons', null);
            updateResults();
            updateBreadcrumb();
        }

        function clearDetailFilters() {
            currentFilters.detailFilter = null;
            updateActiveButtons('detailFilterButtons', null);
            updateResults();
            updateBreadcrumb();
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            updateResults();
            updateBreadcrumb();
        });
    </script>
</body>
</html>
