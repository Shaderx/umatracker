<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Uma Musume Hidden Factor Filter</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #ff6b6b, #ffa500);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .main-content {
            padding: 30px;
        }

        .filter-section {
            margin-bottom: 30px;
        }

        .filter-level {
            margin-bottom: 20px;
        }

        .filter-level h3 {
            margin-bottom: 15px;
            color: #333;
            font-size: 1.3em;
            border-bottom: 2px solid #eee;
            padding-bottom: 5px;
        }

        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }

        .filter-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.95em;
            font-weight: 500;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .filter-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
        }

        .filter-btn.active {
            background: linear-gradient(135deg, #ff6b6b, #ffa500);
            transform: scale(1.05);
        }

        .clear-btn {
            background: linear-gradient(135deg, #6c757d, #495057);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            margin-left: 10px;
        }

        .clear-btn:hover {
            background: linear-gradient(135deg, #495057, #343a40);
        }

        .breadcrumb {
            background: #f8f9fa;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 0.95em;
            color: #6c757d;
        }

        .results-section {
            margin-top: 30px;
        }

        .results-section h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.4em;
        }

        .factor-card {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .factor-card:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .factor-name {
            font-size: 1.2em;
            font-weight: bold;
            color: #495057;
            margin-bottom: 8px;
        }

        .factor-condition {
            color: #6c757d;
            line-height: 1.5;
        }

        .no-results {
            text-align: center;
            padding: 40px;
            color: #6c757d;
            font-size: 1.1em;
        }

        .stats {
            background: #e9ecef;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            color: #495057;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }
            
            .button-group {
                justify-content: center;
            }
            
            .filter-btn {
                font-size: 0.9em;
                padding: 10px 16px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🏇 Uma Musume Hidden Factor Filter</h1>
            <p>Find hidden factors by clicking through conditions step by step</p>
        </div>

        <div class="main-content">
            <div class="filter-section">
                <div class="breadcrumb" id="breadcrumb">
                    Click a main category to start filtering
                </div>

                <div class="stats" id="stats">
                    Showing all 46 hidden factors
                </div>

                <div class="filter-level" id="mainCategories">
                    <h3>🎯 Main Categories</h3>
                    <div class="button-group">
                        <button class="filter-btn" onclick="selectMainCategory('racing')">🏇 Racing</button>
                        <button class="filter-btn" onclick="selectMainCategory('skills')">🌟 Skills</button>
                        <button class="filter-btn" onclick="selectMainCategory('training')">💪 Training</button>
                        <button class="filter-btn" onclick="selectMainCategory('aptitudes')">📊 Aptitudes & Stats</button>
                        <button class="filter-btn" onclick="selectMainCategory('events')">🎯 Events & Misc</button>
                        <button class="clear-btn" onclick="clearFilters()">Clear All</button>
                    </div>
                </div>

                <div class="filter-level" id="subCategories" style="display: none;">
                    <h3 id="subCategoryTitle">Subcategories</h3>
                    <div class="button-group" id="subCategoryButtons"></div>
                </div>

                <div class="filter-level" id="detailFilters" style="display: none;">
                    <h3 id="detailFilterTitle">Detailed Filters</h3>
                    <div class="button-group" id="detailFilterButtons"></div>
                </div>
            </div>

            <div class="results-section">
                <h3>📋 Matching Hidden Factors</h3>
                <div id="results"></div>
            </div>
        </div>
    </div>

    <script>
        // Parse CSV data
        const csvData = `Factor Name (JP/EN),Conditions
連戦連勝 (Ren Sen Renshou),"Win a high number of consecutive races, such as 12 or more, primarily in G1 races."
東の雄 (Higashi no Ou),"Win 7 or more G1 races in Eastern Japan (Tokyo, Nakayama)."
西の雄 (Nishi no Ou),"Win 7 or more G1 races in Western Japan (Kyoto, Hanshin)."
旅人 (Tabibito),Participate in races at 7 or more different racecourses.
全階級制覇 (Zen Kaikyuu Seiha),"Win at least one race in each distance category: Short, Mile, Medium, and Long."
叩き良化型 (Tataki Ryouka-gata),Run 3 consecutive races; may also be tied to the reporter's '悦楽取材' (Pleasure Interview) event.
甲斐性なし (Kaishou nashi),Finish a run with at least one purple skill.
健闘 (Kentou),"Win or lose by a small margin, or possibly by using a Clock to continue a run."
諦めない心 (Akiramenai Kokoro),"Use a Clock to continue after a loss, or lose by a small margin multiple times."
反骨精神 (Hankotsu Seishin),Win a race with a C or lower aptitude for either ground or distance.
パーフェクトクラウン (Perfect Crown),"Win the Japanese Triple Crown (皐月賞, 日本ダービー, 菊花賞) plus specific trial races (弥生賞, 青葉賞, and 神戸新聞杯)."
パーフェクトティアラ (Perfect Tiara),"Win the Japanese Fillies' Triple Crown (桜花賞, オークス, 秋華賞) plus specific trial races (チューリップS, フローラS, and ローズS)."
一年の計は (Ichinen no Kei wa),Win either the 中山金杯 or 京都金杯 in the senior year.
SSS,Win 3 races from the Summer Sprint Series.
SMS,Win 3 races from the Summer Mile Series.
S2000,Win 3 races from the Summer 2000 Series.
星に願いを (Hoshi ni Negai wo),Win 3 races from the 'star/constellation' series.
ジュエリー (Jewelry),Win 3 races from the 'jewel' series.
新聞屋さん (Shimbun-ya-san),"Win all four races with '新聞杯' in their name: 京都新聞杯, 神戸新聞杯, 中日新聞杯, and 東京新聞杯."
右/左の目覚め (Migi/Hidari no Mezame),Win at least 6 races with a specified turn direction.
春/夏/秋/冬の目覚め (Haru/Natsu/Aki/Fuyu no Mezame),Win at least 6 races in the specified season.
お嬢様 (Ojou-sama),Obtain the skills 'しとやかな足取り' and '品行方正' simultaneously.
太陽系 (Taiyou-kei),Obtain exactly 8 skills with '◯' in their names.
ノーブレーキ (No Brake),Obtain at least 3 skills related to downhill running.
山娘 (Yama-musume),"Obtain at least 3 skills related to uphill running: '登山家', '勢い任せ', '十万バリキ', or '登竜門'."
ピカピカ (Pikapika),Obtain at least 2 skills with '光' (light) or '電' (electricity) in their names.
ビュービュー (Byuubyuu),Obtain at least 2 skills with '風' (wind) in their names.
全天候型 (Zentenkou-gata),"Obtain the skills '晴れの日◯', '曇りの日◯', '雨の日◯', and '雪の日◯' simultaneously."
出たとこ勝負 (Detatoko Shoubu),Obtain the skills '向こう見ず' and '後先恐れず' simultaneously.
企画上手 (Kikaku Jouzu),Obtain at least 3 skills with 'プラン' (plan) in their names.
策略家 (Sakuryaku-ka),Obtain at least 2 skills with '策' (strategy) in their names.
ウマ娘よ大志を抱け (Uma Musume yo Taishi wo Idake),Obtain at least 3 skills with '志' (ambition) in their names.
大肺活量 (Dai Haikatsuryou),Obtain at least 3 skills with '呼吸' (breathing) or '息' (breath) in their names.
東奔西走 (Touhon Seisou),Obtain at least 3 racecourse passive skills at level ◎.
想いの継ぎ手 (Omoi no Tsugite),Obtain at least 3 inherited unique skills.
信頼の証 (Shinrai no Akashi),Take at least 6 regular outings with the Uma Musume.
リフレッシュ (Refresh),Trigger the hot spring event by winning the '温泉旅行券' lottery ticket.
二刀流 (Nitou-ryuu),"Have all ground aptitudes (Turf/Dirt) at A, and win on both surfaces."
SMILE,Have all distance aptitudes at A or higher.
自由自在 (Jiyuu Jizai),Have all racing style aptitudes at A or higher.
ジャックポット (Jackpot),Have at least 3 status stats reach exactly 777.
スピードの目覚め (Speed no Mezame),Successfully complete Speed training at least 12 times.
スタミナの目覚め (Stamina no Mezame),Successfully complete Stamina training at least 12 times.
パワーの目覚め (Power no Mezame),Successfully complete Power training at least 12 times.
根性の目覚め (Guts no Mezame),Successfully complete Guts training at least 12 times.
賢さの目覚め (Intelligence no Mezame),Successfully complete Intelligence training at least 12 times.`;

        // Parse the CSV data into an array of objects
        function parseCSV(csvText) {
            const lines = csvText.trim().split('\n');
            const headers = lines[0].split(',');
            const factors = [];

            for (let i = 1; i < lines.length; i++) {
                const line = lines[i];
                if (line.trim()) {
                    const match = line.match(/^([^,]+),(.*)$/);
                    if (match) {
                        factors.push({
                            name: match[1].trim(),
                            condition: match[2].trim().replace(/^"(.*)"$/, '$1')
                        });
                    }
                }
            }
            return factors;
        }

        const allFactors = parseCSV(csvData);
        let currentFilters = {
            mainCategory: null,
            subCategory: null,
            detailFilter: null
        };

        // Category definitions with intelligent classification
        const categoryData = {
            racing: {
                name: '🏇 Racing',
                subcategories: {
                    winRaces: {
                        name: 'Win Races',
                        keywords: ['win', 'victory'],
                        detailFilters: {
                            consecutive: { name: 'Consecutive Wins', keywords: ['consecutive', '連戦', '連勝'] },
                            location: { name: 'Location-based', keywords: ['eastern', 'western', '東', '西', 'tokyo', 'kyoto', 'nakayama', 'hanshin'] },
                            series: { name: 'Race Series', keywords: ['triple crown', 'series', 'summer', 'sss', 'sms', 's2000', 'crown', 'tiara', '新聞'] },
                            distance: { name: 'Distance Categories', keywords: ['distance category', 'short', 'mile', 'medium', 'long', '階級'] },
                            timing: { name: 'Time-based', keywords: ['season', 'turn direction', '春', '夏', '秋', '冬', '右', '左', '目覚め'] },
                            special: { name: 'Special Conditions', keywords: ['aptitude', 'margin', 'clock', 'senior year', '金杯'] }
                        }
                    },
                    participation: {
                        name: 'Race Participation',
                        keywords: ['participate', 'racecourse', 'run'],
                        detailFilters: {
                            multiple: { name: 'Multiple Racecourses', keywords: ['different racecourse', 'racecourse'] },
                            consecutive: { name: 'Consecutive Races', keywords: ['consecutive races', 'run 3'] }
                        }
                    },
                    performance: {
                        name: 'Race Performance',
                        keywords: ['margin', 'clock', 'lose'],
                        detailFilters: {
                            margins: { name: 'Small Margins', keywords: ['small margin'] },
                            continue: { name: 'Continue After Loss', keywords: ['clock', 'continue'] }
                        }
                    }
                }
            },
            skills: {
                name: '🌟 Skills',
                subcategories: {
                    themed: {
                        name: 'Themed Skills',
                        keywords: ['skills with', 'skills related'],
                        detailFilters: {
                            symbols: { name: 'Symbol Skills', keywords: ['◯', 'circle'] },
                            elements: { name: 'Element Skills', keywords: ['光', '電', '風', 'light', 'electricity', 'wind'] },
                            terrain: { name: 'Terrain Skills', keywords: ['downhill', 'uphill', '登山', '勢い'] },
                            weather: { name: 'Weather Skills', keywords: ['晴れ', '曇り', '雨', '雪', 'weather'] },
                            strategy: { name: 'Strategy Skills', keywords: ['プラン', '策', '志', 'plan', 'strategy', 'ambition'] },
                            physical: { name: 'Physical Skills', keywords: ['呼吸', '息', 'breathing', 'breath'] }
                        }
                    },
                    combinations: {
                        name: 'Skill Combinations',
                        keywords: ['simultaneously', 'combination'],
                        detailFilters: {
                            specific: { name: 'Specific Combinations', keywords: ['しとやか', '品行方正', '向こう見ず', '後先'] }
                        }
                    },
                    special: {
                        name: 'Special Skills',
                        keywords: ['purple', 'inherited', 'unique', 'racecourse passive'],
                        detailFilters: {
                            purple: { name: 'Purple Skills', keywords: ['purple skill'] },
                            inherited: { name: 'Inherited Skills', keywords: ['inherited unique'] },
                            passive: { name: 'Passive Skills', keywords: ['racecourse passive'] }
                        }
                    }
                }
            },
            training: {
                name: '💪 Training',
                subcategories: {
                    stats: {
                        name: 'Stat Training',
                        keywords: ['complete', 'training'],
                        detailFilters: {
                            speed: { name: 'Speed Training', keywords: ['speed training'] },
                            stamina: { name: 'Stamina Training', keywords: ['stamina training'] },
                            power: { name: 'Power Training', keywords: ['power training'] },
                            guts: { name: 'Guts Training', keywords: ['guts training'] },
                            intelligence: { name: 'Intelligence Training', keywords: ['intelligence training'] }
                        }
                    }
                }
            },
            aptitudes: {
                name: '📊 Aptitudes & Stats',
                subcategories: {
                    aptitudes: {
                        name: 'Aptitudes',
                        keywords: ['aptitude', 'aptitudes'],
                        detailFilters: {
                            ground: { name: 'Ground Aptitudes', keywords: ['ground aptitudes', 'turf', 'dirt'] },
                            distance: { name: 'Distance Aptitudes', keywords: ['distance aptitudes'] },
                            racing: { name: 'Racing Style Aptitudes', keywords: ['racing style aptitudes'] }
                        }
                    },
                    stats: {
                        name: 'Status Stats',
                        keywords: ['status stats', 'reach'],
                        detailFilters: {
                            specific: { name: 'Specific Values', keywords: ['777', 'exactly'] }
                        }
                    }
                }
            },
            events: {
                name: '🎯 Events & Misc',
                subcategories: {
                    social: {
                        name: 'Social Events',
                        keywords: ['outings', 'regular outings'],
                        detailFilters: {
                            outings: { name: 'Regular Outings', keywords: ['regular outings'] }
                        }
                    },
                    special: {
                        name: 'Special Events',
                        keywords: ['hot spring', 'lottery', 'event'],
                        detailFilters: {
                            hotspring: { name: 'Hot Spring Event', keywords: ['hot spring', '温泉'] }
                        }
                    }
                }
            }
        };

        // Filter factors based on current selection
        function getFilteredFactors() {
            let filtered = [...allFactors];

            if (currentFilters.mainCategory) {
                const category = categoryData[currentFilters.mainCategory];
                filtered = filtered.filter(factor => 
                    matchesKeywords(factor.condition.toLowerCase(), getAllCategoryKeywords(category))
                );

                if (currentFilters.subCategory) {
                    const subCategory = category.subcategories[currentFilters.subCategory];
                    filtered = filtered.filter(factor => 
                        matchesKeywords(factor.condition.toLowerCase(), subCategory.keywords)
                    );

                    if (currentFilters.detailFilter) {
                        const detailFilter = subCategory.detailFilters[currentFilters.detailFilter];
                        filtered = filtered.filter(factor => 
                            matchesKeywords(factor.condition.toLowerCase(), detailFilter.keywords)
                        );
                    }
                }
            }

            return filtered;
        }

        function getAllCategoryKeywords(category) {
            let allKeywords = [];
            Object.values(category.subcategories).forEach(sub => {
                allKeywords = allKeywords.concat(sub.keywords);
                if (sub.detailFilters) {
                    Object.values(sub.detailFilters).forEach(detail => {
                        allKeywords = allKeywords.concat(detail.keywords);
                    });
                }
            });
            return allKeywords;
        }

        function matchesKeywords(text, keywords) {
            return keywords.some(keyword => text.includes(keyword.toLowerCase()));
        }

        // UI Functions
        function selectMainCategory(category) {
            currentFilters.mainCategory = category;
            currentFilters.subCategory = null;
            currentFilters.detailFilter = null;
            
            updateActiveButtons('mainCategories', category);
            showSubCategories(category);
            hideElement('detailFilters');
            updateResults();
            updateBreadcrumb();
        }

        function selectSubCategory(subCategory) {
            currentFilters.subCategory = subCategory;
            currentFilters.detailFilter = null;
            
            updateActiveButtons('subCategoryButtons', subCategory);
            showDetailFilters(currentFilters.mainCategory, subCategory);
            updateResults();
            updateBreadcrumb();
        }

        function selectDetailFilter(detailFilter) {
            currentFilters.detailFilter = detailFilter;
            
            updateActiveButtons('detailFilterButtons', detailFilter);
            updateResults();
            updateBreadcrumb();
        }

        function showSubCategories(mainCategory) {
            const subCategoriesDiv = document.getElementById('subCategories');
            const buttonsDiv = document.getElementById('subCategoryButtons');
            const titleDiv = document.getElementById('subCategoryTitle');
            
            const category = categoryData[mainCategory];
            titleDiv.textContent = `${category.name} - Subcategories`;
            
            buttonsDiv.innerHTML = '';
            Object.entries(category.subcategories).forEach(([key, subCat]) => {
                const button = document.createElement('button');
                button.className = 'filter-btn';
                button.textContent = subCat.name;
                button.onclick = () => selectSubCategory(key);
                buttonsDiv.appendChild(button);
            });
            
            const clearBtn = document.createElement('button');
            clearBtn.className = 'clear-btn';
            clearBtn.textContent = 'Back to Main';
            clearBtn.onclick = () => clearSubFilters();
            buttonsDiv.appendChild(clearBtn);
            
            subCategoriesDiv.style.display = 'block';
        }

        function showDetailFilters(mainCategory, subCategory) {
            const detailFiltersDiv = document.getElementById('detailFilters');
            const buttonsDiv = document.getElementById('detailFilterButtons');
            const titleDiv = document.getElementById('detailFilterTitle');
            
            const category = categoryData[mainCategory];
            const subCat = category.subcategories[subCategory];
            
            if (!subCat.detailFilters) {
                detailFiltersDiv.style.display = 'none';
                return;
            }
            
            titleDiv.textContent = `${subCat.name} - Detailed Filters`;
            
            buttonsDiv.innerHTML = '';
            Object.entries(subCat.detailFilters).forEach(([key, detail]) => {
                const button = document.createElement('button');
                button.className = 'filter-btn';
                button.textContent = detail.name;
                button.onclick = () => selectDetailFilter(key);
                buttonsDiv.appendChild(button);
            });
            
            const clearBtn = document.createElement('button');
            clearBtn.className = 'clear-btn';
            clearBtn.textContent = 'Back to Subcategory';
            clearBtn.onclick = () => clearDetailFilters();
            buttonsDiv.appendChild(clearBtn);
            
            detailFiltersDiv.style.display = 'block';
        }

        function updateActiveButtons(containerId, activeValue) {
            const container = document.getElementById(containerId);
            const buttons = container.querySelectorAll('.filter-btn');
            buttons.forEach(btn => {
                btn.classList.remove('active');
            });
            
            if (activeValue) {
                buttons.forEach(btn => {
                    if (btn.textContent.toLowerCase().includes(activeValue.toLowerCase()) ||
                        btn.onclick.toString().includes(activeValue)) {
                        btn.classList.add('active');
                    }
                });
            }
        }

        function updateResults() {
            const filtered = getFilteredFactors();
            const resultsDiv = document.getElementById('results');
            const statsDiv = document.getElementById('stats');
            
            statsDiv.textContent = `Showing ${filtered.length} of ${allFactors.length} hidden factors`;
            
            if (filtered.length === 0) {
                resultsDiv.innerHTML = '<div class="no-results">No hidden factors match your current filters.</div>';
                return;
            }
            
            resultsDiv.innerHTML = filtered.map(factor => `
                <div class="factor-card">
                    <div class="factor-name">${factor.name}</div>
                    <div class="factor-condition">${factor.condition}</div>
                </div>
            `).join('');
        }

        function updateBreadcrumb() {
            const breadcrumbDiv = document.getElementById('breadcrumb');
            let breadcrumb = [];
            
            if (currentFilters.mainCategory) {
                const category = categoryData[currentFilters.mainCategory];
                breadcrumb.push(category.name);
                
                if (currentFilters.subCategory) {
                    const subCategory = category.subcategories[currentFilters.subCategory];
                    breadcrumb.push(subCategory.name);
                    
                    if (currentFilters.detailFilter) {
                        const detailFilter = subCategory.detailFilters[currentFilters.detailFilter];
                        breadcrumb.push(detailFilter.name);
                    }
                }
            }
            
            if (breadcrumb.length === 0) {
                breadcrumbDiv.textContent = 'Click a main category to start filtering';
            } else {
                breadcrumbDiv.textContent = breadcrumb.join(' → ');
            }
        }

        function hideElement(elementId) {
            document.getElementById(elementId).style.display = 'none';
        }

        function clearFilters() {
            currentFilters = { mainCategory: null, subCategory: null, detailFilter: null };
            hideElement('subCategories');
            hideElement('detailFilters');
            updateActiveButtons('mainCategories', null);
            updateResults();
            updateBreadcrumb();
        }

        function clearSubFilters() {
            currentFilters.subCategory = null;
            currentFilters.detailFilter = null;
            hideElement('detailFilters');
            updateActiveButtons('subCategoryButtons', null);
            updateResults();
            updateBreadcrumb();
        }

        function clearDetailFilters() {
            currentFilters.detailFilter = null;
            updateActiveButtons('detailFilterButtons', null);
            updateResults();
            updateBreadcrumb();
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            updateResults();
            updateBreadcrumb();
        });
    </script>
</body>
</html>
