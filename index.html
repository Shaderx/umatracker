<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🏇 Uma Musume Hidden Factors Tracker</title>
    
    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="site.webmanifest">
    
    <!-- Styles -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Header -->
    <header>
        <div class="logo-container">
            <img src="icons/icon.webp" alt="Uma Musume Logo" class="app-logo">
        </div>
        <h1>Uma Musume Hidden Factors Tracker</h1>
        <h2 style="margin-top: -10px; margin-bottom: 10px; color: rgba(255,255,255,0.9); font-size: 1.4rem;">ウマ娘 隠し因子トラッカー</h2>
        <div class="subtitle">Track your race progress and unlock hidden factors</div>
        <div class="subtitle" style="margin-top: 5px; font-size: 1rem;">レース進捗を追跡して隠し因子を解放しよう</div>
    </header>

    <div class="discord-contact">
        <button class="discord-btn" onclick="contactOnDiscord()" title="Join Discord server for updates, bugs, and features">
            💬 <span class="discord-text">Join Discord for updates, bug reports & feature requests<br><span style="font-size: 0.8em; opacity: 0.8;">アップデート、バグ報告、機能リクエストはDiscordで</span></span>
        </button>
    </div>

    <!-- Main Container -->
    <div class="container">
        <div class="main-content">
            <!-- Planner Section -->
            <div class="races-section" id="planner-section">
                <h2 class="section-title">Race Planner<br><span style="font-size: 0.8em; font-weight: normal; color: #718096;">レースプランナー（ゲーム風UI）</span></h2>
                <div class="year-tabs">
                    <button class="year-tab active" id="tab-junior" data-year="junior">ジュニア級<br><span style="font-size: 0.8em; font-weight:600;">Junior</span></button>
                    <button class="year-tab" id="tab-classics" data-year="classics">クラシック級<br><span style="font-size: 0.8em; font-weight:600;">Classic</span></button>
                    <button class="year-tab" id="tab-senior" data-year="senior">シニア級<br><span style="font-size: 0.8em; font-weight:600;">Senior</span></button>
                    <div style="margin-left:auto; display:flex; gap:8px;">
                        <button class="filter-btn" id="clear-planner-year-btn">このページをリセット<br><span style="font-size: 0.8em; font-weight:600;">Reset this page</span></button>
                    </div>
                </div>
                <div class="planner-grid" id="planner-grid"></div>
            </div>

            <!-- Progress Section -->
            <div class="progress-section" id="progress-panel">
                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px; gap: 10px;">
                    <h2 class="section-title" style="margin-bottom: 0; flex: 1;">Progress Tracker<br><span style="font-size: 0.8em; font-weight: normal; color: #718096;">進捗トラッカー</span></h2>
                    <button class="btn btn-clear-tracking" id="clear-tracking-btn" onclick="tracker.handleTrackFactor(null)" style="display: none;" title="Clear tracking / 追跡解除">
                        ✖ Clear<br><span style="font-size: 0.7em;">追跡解除</span>
                    </button>
                </div>
                <!-- Storage Controls Toolbar -->
                <div class="storage-toolbar">
                    <button class="btn-storage" id="btn-save" onclick="tracker.openSaveDialog()" title="Save / 保存">
                        💾 <span class="btn-label">Save</span>
                    </button>
                    <button class="btn-storage" id="btn-load" onclick="tracker.openLoadDialog()" title="Load / 読み込み">
                        📂 <span class="btn-label">Load</span>
                    </button>
                    <button class="btn-storage" id="btn-share" onclick="tracker.openShareDialog()" title="Share / 共有">
                        🔗 <span class="btn-label">Share</span>
                    </button>
                </div>
                <!-- Quick Stats Summary -->
                <div class="quick-stats" id="quick-stats">
                    <span class="quick-stat" title="Races Run / 出走数">🏇 <strong id="qs-races">0</strong></span>
                    <span class="quick-stat-separator">•</span>
                    <span class="quick-stat" title="Wins / 勝利数">🏆 <strong id="qs-wins">0</strong></span>
                    <span class="quick-stat-separator">•</span>
                    <span class="quick-stat" title="Factors Completed / 完了">✅ <strong id="qs-completed">0</strong></span>
                    <span class="quick-stat-separator">•</span>
                    <span class="quick-stat" title="In Progress / 進行中">📊 <strong id="qs-progress">0</strong></span>
                </div>
                <div class="hidden-factors" id="hidden-factors"></div>
            </div>
        </div>
    </div>

    <!-- Race Database Section -->
    <div style="max-width: 1400px; margin: 18px auto 0 auto;">
        <div class="races-section" id="calendar-section" style="padding: 18px;">
            <h2 class="section-title">Race Database<br><span style="font-size: 0.8em; font-weight: normal; color: #718096;">レースデータベース</span></h2>
            <div class="controls">
                <button class="filter-btn active" data-filter="all" data-value="all">All Races<br><span style="font-size: 0.7em;">全レース</span></button>
                <button class="filter-btn" data-filter="GI" data-value="GI">G1</button>
                <button class="filter-btn" data-filter="GII" data-value="GII">G2</button>
                <button class="filter-btn" data-filter="GIII" data-value="GIII">G3</button>
                <button class="filter-btn" data-filter="Open" data-value="Open">OP</button>
                <button class="filter-btn" data-filter="Pre-OP" data-value="Pre-OP">Pre-OP</button>
                <button class="filter-btn" data-filter="turf" data-value="turf">Turf<br><span style="font-size: 0.7em;">芝</span></button>
                <button class="filter-btn" data-filter="dirt" data-value="dirt">Dirt<br><span style="font-size: 0.7em;">ダート</span></button>
                <button class="filter-btn" data-filter="short" data-value="short">Short<br><span style="font-size: 0.7em;">短距離</span></button>
                <button class="filter-btn" data-filter="mile" data-value="mile">Mile<br><span style="font-size: 0.7em;">マイル</span></button>
                <button class="filter-btn" data-filter="medium" data-value="medium">Medium<br><span style="font-size: 0.7em;">中距離</span></button>
                <button class="filter-btn" data-filter="long" data-value="long">Long<br><span style="font-size: 0.7em;">長距離</span></button>
                <button class="filter-btn" data-filter="junior" data-value="junior">Junior Year<br><span style="font-size: 0.7em;">ジュニア級</span></button>
                <button class="filter-btn" data-filter="classic" data-value="classic">Classic Year<br><span style="font-size: 0.7em;">クラシック級</span></button>
                <button class="filter-btn" data-filter="senior" data-value="senior">Senior Year<br><span style="font-size: 0.7em;">シニア級</span></button>
                <button class="filter-btn" data-filter="SSS" data-value="SSS">Summer Sprint<br><span style="font-size: 0.7em;">サマースプリント</span></button>
                <button class="filter-btn" data-filter="SMS" data-value="SMS">Summer Mile<br><span style="font-size: 0.7em;">サマーマイル</span></button>
                <button class="filter-btn" data-filter="S2000" data-value="S2000">Summer 2000<br><span style="font-size: 0.7em;">サマー2000</span></button>
                <button class="filter-btn" data-filter="selected" data-value="selected">Selected<br><span style="font-size: 0.7em;">選択済み</span></button>
                <button class="filter-btn" id="tracked-filter-btn" data-filter="tracked" data-value="tracked" style="display: none;">🔍 Tracked<br><span style="font-size: 0.7em;">追跡中</span></button>
                <button class="filter-btn clear-all-btn" id="clear-all-btn" style="border-color: #e53e3e; background: white; color: #e53e3e;">Clear All Selection<br><span style="font-size: 0.7em;">全選択解除</span></button>
            </div>
            <div class="races-grid" id="races-grid"></div>
            <div style="margin-top: 12px; font-size: 0.8rem; color: #718096;"><span id="data-source-indicator"></span></div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="app-footer">
        <div class="footer-content">
            <span class="footer-heart">♥</span>
            <span class="footer-text">Made with love by <strong>shader</strong> on Discord • Please do not message him</span>
        </div>
    </footer>

<!-- Picker Modal -->
    <div id="picker-modal" class="picker-modal hidden">
        <div class="picker-backdrop" onclick="tracker.closePicker()"></div>
        <button class="picker-nav picker-nav-left" onclick="tracker.navigatePickerWithAnimation(-1)" aria-label="Previous">‹</button>
        <button class="picker-nav picker-nav-right" onclick="tracker.navigatePickerWithAnimation(1)" aria-label="Next">›</button>
        <div class="picker-panel" id="picker-panel">
            <div class="picker-carousel" id="picker-carousel">
                <!-- Previous Card -->
                <div class="picker-card picker-card-prev" id="picker-card-prev">
                    <div class="picker-head">
                        <div class="picker-title" id="picker-title-prev"></div>
                        <div style="display: flex; gap: 8px;">
                            <button class="btn btn-secondary toggle-close-on-selection" disabled style="pointer-events: none;">
                                <span class="toggle-icon"></span>
                                <div class="toggle-text">
                                    <div class="toggle-text-en">Auto-close</div>
                                    <div class="toggle-text-jp">自動閉じる</div>
                                </div>
                            </button>
                        </div>
                    </div>
                    <div class="picker-body">
                        <div id="picker-list-prev" class="picker-list"></div>
                    </div>
                    <div class="picker-actions">
                        <button class="btn btn-primary" disabled>
                            <div class="btn-text-en">Done</div>
                            <div class="btn-text-jp">完了</div>
                        </button>
                    </div>
                </div>
                
                <!-- Current Card -->
                <div class="picker-card picker-card-current" id="picker-card-current">
                    <div class="picker-head">
                        <div class="picker-title" id="picker-title">レース選択</div>
                        <div style="display: flex; gap: 8px;">
                            <button class="btn btn-secondary toggle-close-on-selection" id="toggle-close-btn" onclick="tracker.toggleCloseOnSelection()" title="Toggle close on selection">
                                <span class="toggle-icon"></span>
                                <div class="toggle-text">
                                    <div class="toggle-text-en">Auto-close</div>
                                    <div class="toggle-text-jp">自動閉じる</div>
                                </div>
                            </button>
                        </div>
                    </div>
                    <div class="picker-body">
                        <div id="picker-list" class="picker-list"></div>
                    </div>
                    <div class="picker-actions">
                        <button class="btn btn-primary" onclick="tracker.closePicker()">
                            <div class="btn-text-en">Done</div>
                            <div class="btn-text-jp">完了</div>
                        </button>
                    </div>
                </div>
                
                <!-- Next Card -->
                <div class="picker-card picker-card-next" id="picker-card-next">
                    <div class="picker-head">
                        <div class="picker-title" id="picker-title-next"></div>
                        <div style="display: flex; gap: 8px;">
                            <button class="btn btn-secondary toggle-close-on-selection" disabled style="pointer-events: none;">
                                <span class="toggle-icon"></span>
                                <div class="toggle-text">
                                    <div class="toggle-text-en">Auto-close</div>
                                    <div class="toggle-text-jp">自動閉じる</div>
                                </div>
                            </button>
                        </div>
                    </div>
                    <div class="picker-body">
                        <div id="picker-list-next" class="picker-list"></div>
                    </div>
                    <div class="picker-actions">
                        <button class="btn btn-primary" disabled>
                            <div class="btn-text-en">Done</div>
                            <div class="btn-text-jp">完了</div>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Swipe Indicator -->
            <div class="picker-swipe-indicator">
                <div class="swipe-hint">
                    <span class="swipe-icon">←</span>
                    <span class="swipe-text">Swipe</span>
                    <span class="swipe-icon">→</span>
                </div>
                <div class="picker-pagination" id="picker-pagination"></div>
            </div>
        </div>
        <!-- Mobile Navigation Arrows -->
        <div class="picker-mobile-nav">
            <button class="picker-mobile-nav-btn picker-mobile-nav-prev" onclick="tracker.navigatePickerWithAnimation(-1)" aria-label="Previous">
                <span>‹</span>
                <span class="nav-label">Previous</span>
            </button>
            <button class="picker-mobile-close-btn" onclick="tracker.closePicker()" aria-label="Close">
                ✕
            </button>
            <button class="picker-mobile-nav-btn picker-mobile-nav-next" onclick="tracker.navigatePickerWithAnimation(1)" aria-label="Next">
                <span class="nav-label">Next</span>
                <span>›</span>
            </button>
        </div>
    </div>

    <!-- Save Dialog Modal -->
    <div id="save-modal" class="storage-modal hidden">
        <div class="storage-backdrop" onclick="tracker.closeSaveDialog()"></div>
        <div class="storage-panel">
            <div class="storage-header">
                <h3>💾 Save Progress / 進捗を保存</h3>
                <button class="close-btn" onclick="tracker.closeSaveDialog()">×</button>
            </div>
            <div class="storage-body">
                <div class="save-slots-grid" id="save-slots-grid"></div>
            </div>
        </div>
    </div>

    <!-- Load Dialog Modal -->
    <div id="load-modal" class="storage-modal hidden">
        <div class="storage-backdrop" onclick="tracker.closeLoadDialog()"></div>
        <div class="storage-panel">
            <div class="storage-header">
                <h3>📂 Load Progress / 進捗を読み込み</h3>
                <button class="close-btn" onclick="tracker.closeLoadDialog()">×</button>
            </div>
            <div class="storage-body">
                <div class="load-slots-grid" id="load-slots-grid"></div>
            </div>
        </div>
    </div>

    <!-- Share Dialog Modal -->
    <div id="share-modal" class="storage-modal hidden">
        <div class="storage-backdrop" onclick="tracker.closeShareDialog()"></div>
        <div class="storage-panel">
            <div class="storage-header">
                <h3>🔗 Share Progress / 進捗を共有</h3>
                <button class="close-btn" onclick="tracker.closeShareDialog()">×</button>
            </div>
            <div class="storage-body">
                <div class="share-content">
                    <p>Share this URL to let others see your race plan:</p>
                    <p>このURLを共有して、他の人にレース計画を見せましょう：</p>
                    <div class="share-url-container">
                        <input type="text" id="share-url-input" readonly />
                        <button class="btn-copy" onclick="tracker.copyShareURL()">📋 Copy</button>
                    </div>
                    <div class="share-stats">
                        <div>Races Run / 出走: <strong id="share-stat-races">0</strong></div>
                        <div>Wins / 勝利: <strong id="share-stat-wins">0</strong></div>
                        <div>Factors / 因子: <strong id="share-stat-factors">0</strong></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Naming Popup Modal -->
    <div id="name-modal" class="storage-modal naming-modal hidden">
        <div class="storage-backdrop" onclick="tracker.closeNameDialog()"></div>
        <div class="storage-panel naming-panel">
            <div class="storage-header">
                <h3>✏️ Name Your Save / 保存に名前をつける</h3>
                <button class="close-btn" onclick="tracker.closeNameDialog()">×</button>
            </div>
            <div class="storage-body">
                <div class="naming-content">
                    <label class="naming-label">Save Name / 保存名:</label>
                    <input type="text" id="name-input" class="naming-input" maxlength="50" placeholder="My Epic Run..." />
                    <div class="naming-actions">
                        <button class="btn btn-secondary" onclick="tracker.closeNameDialog()">Cancel / キャンセル</button>
                        <button class="btn btn-primary" onclick="tracker.confirmSaveName()">Save / 保存</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <!-- LZ-String for URL compression -->
    <script src="https://cdn.jsdelivr.net/npm/lz-string@1.5.0/libs/lz-string.min.js"></script>
    
    <!-- Race data -->
    <script src="races.js"></script>
    
    <!-- New modular app (ES6 modules) -->
    <script type="module" src="app.js?v=20251005181500"></script>
</body>
</html>
