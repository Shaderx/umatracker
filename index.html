<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ‡ Uma Musume Hidden Factors Tracker</title>
    
    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="site.webmanifest">
    
    <!-- Styles -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Header -->
    <header>
        <div class="logo-container">
            <img src="icons/icon.webp" alt="Uma Musume Logo" class="app-logo">
        </div>
        <h1>Uma Musume Hidden Factors Tracker</h1>
        <h2 style="margin-top: -10px; margin-bottom: 10px; color: rgba(255,255,255,0.9); font-size: 1.4rem;">ã‚¦ãƒå¨˜ éš ã—å› å­ãƒˆãƒ©ãƒƒã‚«ãƒ¼</h2>
        <div class="subtitle">Track your race progress and unlock hidden factors</div>
        <div class="subtitle" style="margin-top: 5px; font-size: 1rem;">ãƒ¬ãƒ¼ã‚¹é€²æ—ã‚’è¿½è·¡ã—ã¦éš ã—å› å­ã‚’è§£æ”¾ã—ã‚ˆã†</div>
    </header>

    <div class="discord-contact">
        <button class="discord-btn" onclick="contactOnDiscord()" title="Join Discord server for updates, bugs, and features">
            ğŸ’¬ <span class="discord-text">Join Discord for updates, bug reports & feature requests<br><span style="font-size: 0.8em; opacity: 0.8;">ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã€ãƒã‚°å ±å‘Šã€æ©Ÿèƒ½ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯Discordã§</span></span>
        </button>
    </div>

    <!-- Main Container -->
    <div class="container">
        <div class="main-content">
            <!-- Planner Section -->
            <div class="races-section" id="planner-section">
                <h2 class="section-title">Race Planner<br><span style="font-size: 0.8em; font-weight: normal; color: #718096;">ãƒ¬ãƒ¼ã‚¹ãƒ—ãƒ©ãƒ³ãƒŠãƒ¼ï¼ˆã‚²ãƒ¼ãƒ é¢¨UIï¼‰</span></h2>
                <div class="year-tabs">
                    <button class="year-tab active" id="tab-junior" data-year="junior">ã‚¸ãƒ¥ãƒ‹ã‚¢ç´š<br><span style="font-size: 0.8em; font-weight:600;">Junior</span></button>
                    <button class="year-tab" id="tab-classics" data-year="classics">ã‚¯ãƒ©ã‚·ãƒƒã‚¯ç´š<br><span style="font-size: 0.8em; font-weight:600;">Classic</span></button>
                    <button class="year-tab" id="tab-senior" data-year="senior">ã‚·ãƒ‹ã‚¢ç´š<br><span style="font-size: 0.8em; font-weight:600;">Senior</span></button>
                    <div style="margin-left:auto; display:flex; gap:8px;">
                        <button class="filter-btn" id="clear-planner-year-btn">ã“ã®ãƒšãƒ¼ã‚¸ã‚’ãƒªã‚»ãƒƒãƒˆ<br><span style="font-size: 0.8em; font-weight:600;">Reset this page</span></button>
                    </div>
                </div>
                <div class="planner-grid" id="planner-grid"></div>
            </div>

            <!-- Progress Section -->
            <div class="progress-section" id="progress-panel">
                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px; gap: 10px;">
                    <h2 class="section-title" style="margin-bottom: 0; flex: 1;">Progress Tracker<br><span style="font-size: 0.8em; font-weight: normal; color: #718096;">é€²æ—ãƒˆãƒ©ãƒƒã‚«ãƒ¼</span></h2>
                    <button class="btn btn-clear-tracking" id="clear-tracking-btn" onclick="tracker.handleTrackFactor(null)" style="display: none;" title="Clear tracking / è¿½è·¡è§£é™¤">
                        âœ– Clear<br><span style="font-size: 0.7em;">è¿½è·¡è§£é™¤</span>
                    </button>
                </div>
                <!-- Storage Controls Toolbar -->
                <div class="storage-toolbar">
                    <button class="btn-storage" id="btn-save" onclick="tracker.openSaveDialog()" title="Save / ä¿å­˜">
                        ğŸ’¾ <span class="btn-label">Save</span>
                    </button>
                    <button class="btn-storage" id="btn-load" onclick="tracker.openLoadDialog()" title="Load / èª­ã¿è¾¼ã¿">
                        ğŸ“‚ <span class="btn-label">Load</span>
                    </button>
                    <button class="btn-storage" id="btn-share" onclick="tracker.openShareDialog()" title="Share / å…±æœ‰">
                        ğŸ”— <span class="btn-label">Share</span>
                    </button>
                </div>
                <!-- Quick Stats Summary -->
                <div class="quick-stats" id="quick-stats">
                    <span class="quick-stat" title="Races Run / å‡ºèµ°æ•°">ğŸ‡ <strong id="qs-races">0</strong></span>
                    <span class="quick-stat-separator">â€¢</span>
                    <span class="quick-stat" title="Wins / å‹åˆ©æ•°">ğŸ† <strong id="qs-wins">0</strong></span>
                    <span class="quick-stat-separator">â€¢</span>
                    <span class="quick-stat" title="Factors Completed / å®Œäº†">âœ… <strong id="qs-completed">0</strong></span>
                    <span class="quick-stat-separator">â€¢</span>
                    <span class="quick-stat" title="In Progress / é€²è¡Œä¸­">ğŸ“Š <strong id="qs-progress">0</strong></span>
                </div>
                <div class="hidden-factors" id="hidden-factors"></div>
            </div>
        </div>
    </div>

    <!-- Race Database Section -->
    <div style="max-width: 1400px; margin: 18px auto 0 auto;">
        <div class="races-section" id="calendar-section" style="padding: 18px;">
            <h2 class="section-title">Race Database<br><span style="font-size: 0.8em; font-weight: normal; color: #718096;">ãƒ¬ãƒ¼ã‚¹ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹</span></h2>
            <div class="controls">
                <button class="filter-btn active" data-filter="all" data-value="all">All Races<br><span style="font-size: 0.7em;">å…¨ãƒ¬ãƒ¼ã‚¹</span></button>
                <button class="filter-btn" data-filter="GI" data-value="GI">G1</button>
                <button class="filter-btn" data-filter="GII" data-value="GII">G2</button>
                <button class="filter-btn" data-filter="GIII" data-value="GIII">G3</button>
                <button class="filter-btn" data-filter="Open" data-value="Open">OP</button>
                <button class="filter-btn" data-filter="Pre-OP" data-value="Pre-OP">Pre-OP</button>
                <button class="filter-btn" data-filter="turf" data-value="turf">Turf<br><span style="font-size: 0.7em;">èŠ</span></button>
                <button class="filter-btn" data-filter="dirt" data-value="dirt">Dirt<br><span style="font-size: 0.7em;">ãƒ€ãƒ¼ãƒˆ</span></button>
                <button class="filter-btn" data-filter="short" data-value="short">Short<br><span style="font-size: 0.7em;">çŸ­è·é›¢</span></button>
                <button class="filter-btn" data-filter="mile" data-value="mile">Mile<br><span style="font-size: 0.7em;">ãƒã‚¤ãƒ«</span></button>
                <button class="filter-btn" data-filter="medium" data-value="medium">Medium<br><span style="font-size: 0.7em;">ä¸­è·é›¢</span></button>
                <button class="filter-btn" data-filter="long" data-value="long">Long<br><span style="font-size: 0.7em;">é•·è·é›¢</span></button>
                <button class="filter-btn" data-filter="junior" data-value="junior">Junior Year<br><span style="font-size: 0.7em;">ã‚¸ãƒ¥ãƒ‹ã‚¢ç´š</span></button>
                <button class="filter-btn" data-filter="classic" data-value="classic">Classic Year<br><span style="font-size: 0.7em;">ã‚¯ãƒ©ã‚·ãƒƒã‚¯ç´š</span></button>
                <button class="filter-btn" data-filter="senior" data-value="senior">Senior Year<br><span style="font-size: 0.7em;">ã‚·ãƒ‹ã‚¢ç´š</span></button>
                <button class="filter-btn" data-filter="SSS" data-value="SSS">Summer Sprint<br><span style="font-size: 0.7em;">ã‚µãƒãƒ¼ã‚¹ãƒ—ãƒªãƒ³ãƒˆ</span></button>
                <button class="filter-btn" data-filter="SMS" data-value="SMS">Summer Mile<br><span style="font-size: 0.7em;">ã‚µãƒãƒ¼ãƒã‚¤ãƒ«</span></button>
                <button class="filter-btn" data-filter="S2000" data-value="S2000">Summer 2000<br><span style="font-size: 0.7em;">ã‚µãƒãƒ¼2000</span></button>
                <button class="filter-btn" data-filter="selected" data-value="selected">Selected<br><span style="font-size: 0.7em;">é¸æŠæ¸ˆã¿</span></button>
                <button class="filter-btn" id="tracked-filter-btn" data-filter="tracked" data-value="tracked" style="display: none;">ğŸ” Tracked<br><span style="font-size: 0.7em;">è¿½è·¡ä¸­</span></button>
                <button class="filter-btn clear-all-btn" id="clear-all-btn" style="border-color: #e53e3e; background: white; color: #e53e3e;">Clear All Selection<br><span style="font-size: 0.7em;">å…¨é¸æŠè§£é™¤</span></button>
            </div>
            <div class="races-grid" id="races-grid"></div>
            <div style="margin-top: 12px; font-size: 0.8rem; color: #718096;"><span id="data-source-indicator"></span></div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="app-footer">
        <div class="footer-content">
            <span class="footer-heart">â™¥</span>
            <span class="footer-text">Made with love by <strong>shader</strong> on Discord â€¢ Please do not message him</span>
        </div>
    </footer>

<!-- Picker Modal -->
    <div id="picker-modal" class="picker-modal hidden">
        <div class="picker-backdrop" onclick="tracker.closePicker()"></div>
        <button class="picker-nav picker-nav-left" onclick="tracker.navigatePickerWithAnimation(-1)" aria-label="Previous">â€¹</button>
        <button class="picker-nav picker-nav-right" onclick="tracker.navigatePickerWithAnimation(1)" aria-label="Next">â€º</button>
        <div class="picker-panel" id="picker-panel">
            <div class="picker-carousel" id="picker-carousel">
                <!-- Previous Card -->
                <div class="picker-card picker-card-prev" id="picker-card-prev">
                    <div class="picker-head">
                        <div class="picker-title" id="picker-title-prev"></div>
                        <div style="display: flex; gap: 8px;">
                            <button class="btn btn-secondary toggle-close-on-selection" disabled style="pointer-events: none;">
                                <span class="toggle-icon"></span>
                                <div class="toggle-text">
                                    <div class="toggle-text-en">Auto-close</div>
                                    <div class="toggle-text-jp">è‡ªå‹•é–‰ã˜ã‚‹</div>
                                </div>
                            </button>
                        </div>
                    </div>
                    <div class="picker-body">
                        <div id="picker-list-prev" class="picker-list"></div>
                    </div>
                    <div class="picker-actions">
                        <button class="btn btn-primary" disabled>
                            <div class="btn-text-en">Done</div>
                            <div class="btn-text-jp">å®Œäº†</div>
                        </button>
                    </div>
                </div>
                
                <!-- Current Card -->
                <div class="picker-card picker-card-current" id="picker-card-current">
                    <div class="picker-head">
                        <div class="picker-title" id="picker-title">ãƒ¬ãƒ¼ã‚¹é¸æŠ</div>
                        <div style="display: flex; gap: 8px;">
                            <button class="btn btn-secondary toggle-close-on-selection" id="toggle-close-btn" onclick="tracker.toggleCloseOnSelection()" title="Toggle close on selection">
                                <span class="toggle-icon"></span>
                                <div class="toggle-text">
                                    <div class="toggle-text-en">Auto-close</div>
                                    <div class="toggle-text-jp">è‡ªå‹•é–‰ã˜ã‚‹</div>
                                </div>
                            </button>
                        </div>
                    </div>
                    <div class="picker-body">
                        <div id="picker-list" class="picker-list"></div>
                    </div>
                    <div class="picker-actions">
                        <button class="btn btn-primary" onclick="tracker.closePicker()">
                            <div class="btn-text-en">Done</div>
                            <div class="btn-text-jp">å®Œäº†</div>
                        </button>
                    </div>
                </div>
                
                <!-- Next Card -->
                <div class="picker-card picker-card-next" id="picker-card-next">
                    <div class="picker-head">
                        <div class="picker-title" id="picker-title-next"></div>
                        <div style="display: flex; gap: 8px;">
                            <button class="btn btn-secondary toggle-close-on-selection" disabled style="pointer-events: none;">
                                <span class="toggle-icon"></span>
                                <div class="toggle-text">
                                    <div class="toggle-text-en">Auto-close</div>
                                    <div class="toggle-text-jp">è‡ªå‹•é–‰ã˜ã‚‹</div>
                                </div>
                            </button>
                        </div>
                    </div>
                    <div class="picker-body">
                        <div id="picker-list-next" class="picker-list"></div>
                    </div>
                    <div class="picker-actions">
                        <button class="btn btn-primary" disabled>
                            <div class="btn-text-en">Done</div>
                            <div class="btn-text-jp">å®Œäº†</div>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Swipe Indicator -->
            <div class="picker-swipe-indicator">
                <div class="swipe-hint">
                    <span class="swipe-icon">â†</span>
                    <span class="swipe-text">Swipe</span>
                    <span class="swipe-icon">â†’</span>
                </div>
                <div class="picker-pagination" id="picker-pagination"></div>
            </div>
        </div>
        <!-- Mobile Navigation Arrows -->
        <div class="picker-mobile-nav">
            <button class="picker-mobile-nav-btn picker-mobile-nav-prev" onclick="tracker.navigatePickerWithAnimation(-1)" aria-label="Previous">
                <span>â€¹</span>
                <span class="nav-label">Previous</span>
            </button>
            <button class="picker-mobile-close-btn" onclick="tracker.closePicker()" aria-label="Close">
                âœ•
            </button>
            <button class="picker-mobile-nav-btn picker-mobile-nav-next" onclick="tracker.navigatePickerWithAnimation(1)" aria-label="Next">
                <span class="nav-label">Next</span>
                <span>â€º</span>
            </button>
        </div>
    </div>

    <!-- Save Dialog Modal -->
    <div id="save-modal" class="storage-modal hidden">
        <div class="storage-backdrop" onclick="tracker.closeSaveDialog()"></div>
        <div class="storage-panel">
            <div class="storage-header">
                <h3>ğŸ’¾ Save Progress / é€²æ—ã‚’ä¿å­˜</h3>
                <button class="close-btn" onclick="tracker.closeSaveDialog()">Ã—</button>
            </div>
            <div class="storage-body">
                <div class="save-slots-grid" id="save-slots-grid"></div>
            </div>
        </div>
    </div>

    <!-- Load Dialog Modal -->
    <div id="load-modal" class="storage-modal hidden">
        <div class="storage-backdrop" onclick="tracker.closeLoadDialog()"></div>
        <div class="storage-panel">
            <div class="storage-header">
                <h3>ğŸ“‚ Load Progress / é€²æ—ã‚’èª­ã¿è¾¼ã¿</h3>
                <button class="close-btn" onclick="tracker.closeLoadDialog()">Ã—</button>
            </div>
            <div class="storage-body">
                <div class="load-slots-grid" id="load-slots-grid"></div>
            </div>
        </div>
    </div>

    <!-- Share Dialog Modal -->
    <div id="share-modal" class="storage-modal hidden">
        <div class="storage-backdrop" onclick="tracker.closeShareDialog()"></div>
        <div class="storage-panel">
            <div class="storage-header">
                <h3>ğŸ”— Share Progress / é€²æ—ã‚’å…±æœ‰</h3>
                <button class="close-btn" onclick="tracker.closeShareDialog()">Ã—</button>
            </div>
            <div class="storage-body">
                <div class="share-content">
                    <p>Share this URL to let others see your race plan:</p>
                    <p>ã“ã®URLã‚’å…±æœ‰ã—ã¦ã€ä»–ã®äººã«ãƒ¬ãƒ¼ã‚¹è¨ˆç”»ã‚’è¦‹ã›ã¾ã—ã‚‡ã†ï¼š</p>
                    <div class="share-url-container">
                        <input type="text" id="share-url-input" readonly />
                        <button class="btn-copy" onclick="tracker.copyShareURL()">ğŸ“‹ Copy</button>
                    </div>
                    <div class="share-stats">
                        <div>Races Run / å‡ºèµ°: <strong id="share-stat-races">0</strong></div>
                        <div>Wins / å‹åˆ©: <strong id="share-stat-wins">0</strong></div>
                        <div>Factors / å› å­: <strong id="share-stat-factors">0</strong></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Naming Popup Modal -->
    <div id="name-modal" class="storage-modal naming-modal hidden">
        <div class="storage-backdrop" onclick="tracker.closeNameDialog()"></div>
        <div class="storage-panel naming-panel">
            <div class="storage-header">
                <h3>âœï¸ Name Your Save / ä¿å­˜ã«åå‰ã‚’ã¤ã‘ã‚‹</h3>
                <button class="close-btn" onclick="tracker.closeNameDialog()">Ã—</button>
            </div>
            <div class="storage-body">
                <div class="naming-content">
                    <label class="naming-label">Save Name / ä¿å­˜å:</label>
                    <input type="text" id="name-input" class="naming-input" maxlength="50" placeholder="My Epic Run..." />
                    <div class="naming-actions">
                        <button class="btn btn-secondary" onclick="tracker.closeNameDialog()">Cancel / ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                        <button class="btn btn-primary" onclick="tracker.confirmSaveName()">Save / ä¿å­˜</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <!-- LZ-String for URL compression -->
    <script src="https://cdn.jsdelivr.net/npm/lz-string@1.5.0/libs/lz-string.min.js"></script>
    
    <!-- Race data -->
    <script src="races.js"></script>
    
    <!-- New modular app (ES6 modules) -->
    <script type="module" src="app.js?v=20251005181500"></script>
</body>
</html>
